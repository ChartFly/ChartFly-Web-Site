document.addEventListener("DOMContentLoaded", function () {
    updateMarketStatus();
    fetchHaltedStocks();
    fetchMarketHolidays();
    setupWatchlistControls();
});

/* ✅ Fetch Market Holidays from Backend */
async function fetchMarketHolidays() {
    try {
        const response = await fetch("https://chartflybackend.onrender.com/api/holidays/year/2025");
        if (!response.ok) throw new Error("Failed to fetch");
        const holidays = await response.json();
        document.getElementById("market-holidays").innerText =
            holidays.map(h => `${new Date(h.date).toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}, ${h.name}`).join("    |    ");
    } catch (error) {
        console.error("Error fetching holidays:", error);
        document.getElementById("market-holidays").innerText = "Failed to load holidays.";
    }
}

/* ✅ Adjust ChartFly Logo Size & Position */
.logo {
    width: 200px; /* Increased size */
    height: auto;
    margin-left: -30px; /* Shift left */
}

/* ✅ Increase Font Size & Bold Text for Titles */
.header-text h1,
.header-text p,
.holiday-title {
    font-size: 24px;
    font-weight: bold;
}

/* ✅ Reduce Font Size for Holidays & Increase Spacing */
.holiday-text {
    font-size: 14px; /* Reduced by 2X points */
    letter-spacing: 2px; /* More spacing before/after '|' */
}

/* ✅ Reduce Font Size for Table Headers */
th {
    font-size: 12px; /* Reduced 2X points */
    font-weight: bold;
}

/* ✅ Fix Fetch Watchlist Data Button */
document.getElementById("fetchMetrics").addEventListener("click", function () {
    watchlist.forEach(ticker => fetchStockData(ticker));
});

/* ✅ Fix Delete Button Styles */
document.querySelectorAll(".deleteTicker").forEach(button => {
    button.style.backgroundColor = "white";
    button.style.color = "black";
    button.style.boxShadow = "2px 2px 5px rgba(0, 0, 0, 0.2)";
});

/* ✅ Fix Market Status Update */
function updateMarketStatus() {
    const now = new Date();
    const hours = now.getHours();
    const dayOfWeek = now.getDay();
    let statusElement = document.getElementById("market-status-text");
    let status = "Market Closed";

    if (dayOfWeek === 0 || dayOfWeek === 6) {
        status = "Market Closed (Weekend)";
    } else if (hours < 9.5) {
        status = "Pre-Market Trading";
        statusElement.className = "market-status-text market-prepost";
    } else if (hours < 16) {
        status = "Market Open";
        statusElement.className = "market-status-text market-open";
    } else {
        status = "After-Market Trading";
        statusElement.className = "market-status-text market-prepost";
    }
    statusElement.innerText = status;
}